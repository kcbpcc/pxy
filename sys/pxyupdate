#!/bin/bash

dir=$HOME/pxy/sys/exe/run

# Check if the script is in a Git repository
if [ ! -d "$dir/.git" ]; then
    echo "Error: This script must be run from within a Git repository."
    exit 1
fi

# Move to the directory
cd $HOME/pxy/sys/exe/run

# Move all CSV files (including hidden files) to their temporary versions
for file in *.csv _*.csv; do
    mv "$file" "_$file"
done

echo '                                 '
echo "       ******** GET UPDATES *******"
echo '                                 '

# Move to the Git repository directory
cd $dir

git fetch --all
echo '                                 '
echo "       ****** RESET SOFTWARE ******"
echo '                                 '
git reset --hard origin/main
sudo cp ~/pxy/sys/pxy ~/pxy/sys/p
sudo cp ~/pxy/sys/* /usr/local/bin/ &> /dev/null
sudo chmod +x /usr/local/bin/*
echo '                                 '
echo "       ***** UPDATE COMPLETED *****"
echo '                                 '

# Move back to the original directory
cd $HOME/pxy/sys/exe/run

# Move back the temporary versions to their original names
for file in _*.csv; do
    mv "$file" "$(basename "$file" _)"
done
